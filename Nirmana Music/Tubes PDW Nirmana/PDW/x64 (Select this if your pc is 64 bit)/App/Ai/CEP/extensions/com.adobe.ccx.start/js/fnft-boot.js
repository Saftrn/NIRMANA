/**
 * ADOBE CONFIDENTIAL
 *  _________________
 *  Copyright 2016 Adobe Systems Incorporated
 *  All Rights Reserved.
 *
 * NOTICE:  All information contained herein is, and remains
 * the property of Adobe Systems Incorporated and its suppliers,
 * if any.  The intellectual and technical concepts contained
 * herein are proprietary to Adobe Systems Incorporated and its
 * suppliers and are protected by all applicable intellectual property
 * laws, including trade secret and copyright laws.
 * Dissemination of this information or reproduction of this material
 * is strictly forbidden unless prior written permission is obtained
 * from Adobe Systems Incorporated.
 */
!function(){function n(n,t){for(var o=0,u=n.length;o<u;++o)if(!t(n[o]))return!1;return 1}function t(t,o){n(t,function(n){return o(n),1})}function o(o,i,c){function f(n){return n.call?n():a[n]}function h(){if(!--m){a[g]=1,v&&v();for(var o in d)n(o.split("|"),f)&&!t(d[o],f)&&(d[o]=[])}}o=o[r]?o:[o];var p=i&&i.call,v=p?i:c,g=p?o.join(""):i,m=o.length;return setTimeout(function(){t(o,function n(t,o){return null===t?h():(o||/^https?:\/\//.test(t)||!e||(t=t.indexOf(".js")===-1?e+t+".js":e+t),s[t]?(g&&(l[g]=1),2==s[t]?h():setTimeout(function(){n(t,!0)},0)):(s[t]=1,g&&(l[g]=1),void u(t,h)))})},0),this}function u(n,t){var o,u=document.createElement("script");u.onload=u.onerror=u[f]=function(){u[c]&&!/^c|loade/.test(u[c])||o||(u.onload=u[f]=null,o=1,s[n]=2,t())},u.async=1,u.src=i?n+(n.indexOf("?")===-1?"?":"&")+i:n,document.body.appendChild(u)}var e,i,r="push",c="readyState",f="onreadystatechange",a={},l={},d={},s={};o.get=u,o.order=function(n,t,u){!function e(i){i=n.shift(),n.length?o(i,e):o(i,t,u)}()},o.path=function(n){e=n},o.urlArgs=function(n){i=n},o.ready=function(u,e,i){u=u[r]?u:[u];var c=[];return!t(u,function(n){a[n]||c[r](n)})&&n(u,function(n){return a[n]})?e():!function(n){d[n]=d[n]||[],d[n][r](e),i&&i(c)}(u.join("|")),o},o.done=function(n){o([null],n)},window.tophat=o}();
var iaw=iaw||{};iaw.cepUtil={oneTimeHandler:!1,csInterface:window.__adobe_cep__?new CSInterface:null,isStage:null,applicationID:window.__adobe_cep__?(new CSInterface).getApplicationID():"SIMU",events:{EXTENSIONREADY:"com.adobe.ccx.start.extensionReady",LOGPIP:"com.adobe.ccx.start.LOGPIP",kOpenRecentFile:"com.adobe.ccx.start.handleRecentFileOpen",kExecuteMenuCmd:"com.adobe.ccx.start.handleExecuteMenuCommand",kHostStatusChanged:"com.adobe.ccx.start.hostStatusChanged",REQUESTHOSTCLOSE:"com.adobe.ccx.start.requestHostClose",kOpenDropFiles:"com.adobe.ccx.start.handleDropFileOpen",kOpenPreferences:"com.adobe.ccx.start.handleOpenPreferences",kTrialExpired:"com.adobe.ccx.start.trialExpired",kGetUserJSONDataRequest:"com.adobe.ccx.start.getCCXUserJSONData.request",kGetUserJSONDataResponse:"com.adobe.ccx.start.getCCXUserJSONData.response",NEWDOCFROMTEMPLATE:"com.adobe.ccx.fnft.newDocFromTemplate",HOSTCLOSEFNFT:"com.adobe.ccx.fnft.hostRequestsClose",LOADEXTENSION:"com.adobe.extension.loadExtension",INTERACTIVEREADY:"com.adobe.extension.interactiveReady"},authenticationInfo:{adobeStock:{clientID:"AdobeStockClient1",clientScope:"AdobeID,openid,creative_cloud,read_organizations,gnav,additional_info.address.mail_to,sao.stock"},adobeLearn:{clientID:"adobedotcom2",clientScope:"creative_cloud,AdobeID,openid,gnav,read_organizations,additional_info.projectedProductContext"},adobeAccount:{clientID:"adobedotcom2",clientScope:"creative_cloud,AdobeID,openid,gnav,read_organizations,additional_info.projectedProductContext"}},imsInfo:{imsInterface:window.__adobe_cep__?new IMSInterface:null,stageConfig:{label:"Stage",clientId:"CCXInAppWelcome",clientSecret:"2625f91d-efa1-4685-a64d-eb36ad123f09",scope:"openid,AdobeID,creative_cloud",redirectUri:"https://oobe.adobe.com",imsServer:"ims-na1-stg1.adobelogin.com"},productionConfig:{label:"Production",clientId:"CCXInAppWelcome",clientSecret:"75606424-3628-4f70-82fb-9a1bf5dfb6b5",scope:"openid,AdobeID,creative_cloud",redirectUri:"https://oobe.adobe.com",imsServer:"ims-na1.adobelogin.com"},activeConfig:null,imsRef:null,imsTimeout:null,accessToken:null,accessTokenCallbacks:[],accessTokenInProgress:!1,lastAccessTokenTime:(new Date).valueOf(),needRetry:!0,setEnvironment:function(e){this.activeConfig="stage"===e?this.stageConfig:this.productionConfig},isIMSDataValid:function(e){return e&&e.data&&""!==e.data},handleFetchAccessToken:function(e){var t=this;if(!(e&&e.extensionId!==iaw.cepUtil.getExtensionID()||e&&e.data&&e.data.jump)){if(t.imsTimeout&&(clearTimeout(t.imsTimeout),t.imsTimeout=null),t.imsInterface.removeEventListener(t.imsInterface.events.imsFetchAccessToken,t.handleFetchAccessToken),t.isIMSDataValid(e)){switch(typeof e.data){case"string":var n=JSON.parse(e.data);t.accessToken=n&&n.access_token?n.access_token:null;break;case"object":t.accessToken=e.data.access_token||null;break;default:t.accessToken=null}t.accessToken||iaw.log.console("IMS response event: "+JSON.stringify(e))}else iaw.log.console("Failed to get access token: "+JSON.stringify(e));if(t.accessTokenInProgress=!1,iaw.log.console("IMS accessToken is : "+t.accessToken),null===t.accessToken&&t.needRetry)return t.needRetry=!1,void iaw.cepUtil.imsInfo.getAccessToken();var i=t.accessTokenCallbacks.length;if(i){t.lastAccessTokenTime=(new Date).valueOf();for(var a=0;a<i;++a){var o=t.accessTokenCallbacks[a];o&&o(t.accessToken)}t.accessTokenCallbacks=[]}}},accessTokenTimeout:function(){iaw.log.console("IMS access token fetch has timed out"),iaw.cepUtil.imsInfo.imsTimeout=null,iaw.cepUtil.imsInfo.handleFetchAccessToken(null)},getAccessToken:function(e){var t=this;if(t.activeConfig||(t.activeConfig=t.productionConfig),t.accessTokenInProgress)t.accessTokenCallbacks.push(e);else{var n=(new Date).valueOf();if(n-t.lastAccessTokenTime>=864e5&&(iaw.log.console("Clear expired access token."),t.clearAccessToken()),t.accessToken&&0!==t.accessToken.length&&e)return void e(t.accessToken);t.accessTokenInProgress=!0,e&&t.accessTokenCallbacks.push(e),!t.imsRef&&t.imsInterface&&(t.imsRef=t.imsInterface.imsConnect(t.activeConfig.clientId)),t.imsInterface.addEventListener(t.imsInterface.events.imsFetchAccessToken,function(e){this.handleFetchAccessToken(e)}.bind(this)),iaw.localstorage.userID?t.imsInterface.imsFetchAccessToken(t.imsRef,t.activeConfig.clientId,t.activeConfig.clientSecret,iaw.localstorage.userID,t.activeConfig.redirectUri,t.activeConfig.scope):t.imsInterface.imsGetCurrentUserIdHelper(function(e){e&&e.length>0&&t.imsInterface.imsFetchAccessToken(t.imsRef,t.activeConfig.clientId,t.activeConfig.clientSecret,e,t.activeConfig.redirectUri,t.activeConfig.scope)}),t.imsTimeout&&clearTimeout(t.imsTimeout),t.imsTimeout=setTimeout(t.accessTokenTimeout,1e4)}},getIMSAccounts:function(){var e=this;return e.activeConfig||(e.activeConfig=e.productionConfig),!e.imsRef&&e.imsInterface&&(e.imsRef=e.imsInterface.imsConnect(e.activeConfig.clientId)),e.imsInterface.imsFetchAccounts(e.imsRef,e.activeConfig.clientId)},clearAccessToken:function(){this.accessToken=null},createFetchContinueTokenCall:function(e,t,n,i){iaw.log.console("createFetchContinueTokenCall attempting SSO workflows"),this.imsInterface.addEventListener(this.imsInterface.events.imsFetchContinueToken,i);var a=encodeURIComponent(n);this.imsInterface.imsFetchContinueToken(this.imsRef,this.accessToken,e,a,t,"token","")},jumpURL:function(e,t,n,i){var a=this,o=function(e){a.imsInterface.removeEventListener(a.imsInterface.events.imsFetchContinueToken,o),i&&i(a.isIMSDataValid(e)&&e.data.details.jump?e.data.details.jump:n)};iaw.log.console("Attempting SSO workflows for url "+n),this.createFetchContinueTokenCall(e,t,n,o)},isStagingRedirectInEffect:function(){var e=!1;if(!window.__adobe_cep__||!window.DOMParser)return e;try{var t=new CSInterface,n=t.getOSInformation().indexOf("Win")>=0?t.getSystemPath(SystemPath.EXTENSION)+"\\..\\..\\..\\..\\..\\Adobe\\Adobe Creative Cloud\\C3Config.xml":"/Applications/Utilities/Adobe Creative Cloud/C3Config.xml",i=window.cep.fs.readFile(n);if(0!==i.err)return e;var a=(new DOMParser).parseFromString(i.data,"text/xml"),o=a.getElementsByTagName("C3Config")[0].getElementsByTagName("config")[0];if(o)for(var s=o.getElementsByTagName("namespace"),c=0;c<s.length;c++){var r=s[c];if(r&&"accc.container"===r.getAttribute("name"))for(var l=r.getElementsByTagName("property"),d=0;d<l.length;d++){var f=l[d];if(f&&"IMS_ENV"===f.getAttribute("name")){var m=f.firstChild.nodeValue;"STG"===m&&(e=!0)}}}}catch(u){}return e}},imsValid:function(){return Boolean(this.imsInfo.imsInterface)},evalExtendScript:function(e,t){t||(t=function(e){}),window.__adobe_cep__?window.__adobe_cep__.evalScript(e,t):t(null)},evalExtendScriptWithParams:function(){if(arguments.length<2)throw new Error("evalExtendScriptWithParams needs at least two arguments: script and callback");var e,t,n=Array.prototype.slice.call(arguments),i=n.pop(),a=n.shift();e=n.map(function(e){var t="object"==typeof e?JSON.stringify(e):e;return"string"==typeof t?'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"':t}),t=a+"("+e.join(",")+")",window.__adobe_cep__?window.__adobe_cep__.evalScript(t,i):i(null)},sendEvent:function(e,t,n){if(window.__adobe_cep__){var i=new CSEvent;i.scope="APPLICATION",i.appId=this.applicationID,i.extensionId=n||iaw.cepUtil.getExtensionID(),i.type=e,i.data=t,this.csInterface.dispatchEvent(i)}},getExtensionID:function(){return window.__adobe_cep__&&this.csInterface?this.csInterface.getExtensionID():""},getExtensionVersion:function(e){var t={version:"0.0.0",sha:null};if(window.__adobe_cep__){var n=this.csInterface,i=n.getSystemPath(SystemPath.EXTENSION),a=n.getOSInformation(),o=a.indexOf("Win")>=0?"\\":"/",s=i+o+"CSXS"+o+"manifest.xml",c=window.cep.fs.readFile(s);if(window.DOMParser){var r=new window.DOMParser,l=r.parseFromString(c.data,"text/xml"),d=l.getElementsByTagName("ExtensionManifest")[0];"undefined"!=typeof d&&d&&(t.sha=d.attributes.getNamedItem("SHA").nodeValue,t.version=e?d.attributes.getNamedItem("ExtensionBundleVersion").nodeValue:d.getElementsByTagName("ExtensionList")[0].firstElementChild.attributes.getNamedItem("Version").nodeValue)}}return t},isUserSignedIn:function(e){var t=this.imsInfo.imsInterface;t&&t.imsGetCurrentUserIdHelper(function(t){e&&(t&&t.length>0?e(!0,t):e(!1,null))})},setEnvironment:function(e){this.imsInfo.imsInterface&&this.imsInfo.setEnvironment(e)},usingStageAuthentication:function(){return null===this.isStage&&(this.isStage=this.imsInfo.isStagingRedirectInEffect()),this.isStage},getIMSAccessToken:function(e){this.imsInfo.imsInterface&&this.imsInfo.getAccessToken(e)},getPrimaryAccountType:function(){var e="",t="";try{this.imsInfo.imsInterface&&(t=this.imsInfo.getIMSAccounts());var n=(new DOMParser).parseFromString(t,"text/xml"),i=n.getElementsByTagName("UserAccounts")[0].getElementsByTagName("UserData")[0].getElementsByTagName("AccountType")[0];i&&(e=i.firstChild.nodeValue)}catch(a){iaw.log.console("Exception in fetching account type"),iaw.log.exception("Fetch account type exception: "+a.message)}return e},clearAccessToken:function(){this.imsInfo.imsInterface&&this.imsInfo.clearAccessToken()},getUIThemeColor:function(){return this.csInterface?this.csInterface.getHostEnvironment().appSkinInfo.panelBackgroundColor.color:null},addThemeChangeListener:function(){this.csInterface&&this.csInterface.addEventListener("com.adobe.csxs.events.ThemeColorChanged",function(e){iaw.util.setUIThemeMode()}.bind(this))},createJumpURL:function(e,t,n,i){this.imsValid&&this.imsInfo.jumpURL(e,t,n,i)},getExtensionPath:function(){var e=null;if(this.csInterface){var t=this.csInterface.getOSInformation(),n=t.indexOf("Win")>=0?"\\":"/";e=this.csInterface.getSystemPath(SystemPath.EXTENSION)+n}return e}};
tophat.path("./js/"),tophat(["fnft-head.js","fnft-iaw.js"],function(){console.log("[bootstrap] baobab, iaw loaded in",window.performance.now()-window.loadTime,"ms");var e=null;if(iaw.store=new Baobab({},{immutable:!1,persistent:!1}),iaw.perf.logToHighBeam=!0,iaw.perf.set(iaw.perf.timers.DataTime),iaw.perf.set(iaw.perf.timers.HostData),window.__adobe_cep__){var t=iaw.cepUtil.applicationID,a=t.toLowerCase(),i=!1;document.oncontextmenu=function(){return!1},document.title=iaw.cepUtil.getExtensionID(),iaw.cepUtil.addThemeChangeListener();var r=iaw.cepUtil.csInterface?iaw.cepUtil.getUIThemeColor():null;switch(r&&r.red>=184&&document.body.classList.remove("spc--dark"),a){case"phxs":i=!0}iaw.log.console("CEP extension for "+t+" initializing - acquiring host data..."),iaw.util.loadLibrary(iaw.libraryManager.TEMPLATE_ELEMENT_TYPE),i?tophat("app-"+a+".js",function(){iaw.apps[a].init(boot.receivedHostData,"fnft")}):iaw.cepUtil.evalExtendScript("CCXWelcomeXSHost_"+t+'.getUserJSONData("fnft")',function(t){if(t){try{e=JSON.parse(t,iaw.json.fnftDataReceiver)}catch(a){iaw.log.exception("Host JSON parse error: "+a.message)}boot.receivedHostData(e)}})}else boot.initHost(iaw.fnftFakeHostData),boot.initPresets(iaw.fnftPresetData),boot.initTemplates(iaw.fnftFakeStockData,iaw.fnftFakeLicensedTemplates);iaw.perf.set(iaw.perf.timers.UI),tophat(["fnft-uilib.js","spectre-ui.min.js"],function(){tophat("fnft-ui.js",function(){riot.mount("container-templates"),iaw.perf.measure(iaw.perf.timers.UI)})})}),window.boot={receivedHostData:function(e){e&&(e.radarVersion=iaw.cepUtil.getExtensionVersion(!0).version,e.radarSessionGUID=iaw.util.generateGUID(),iaw.perf.measure(iaw.perf.timers.HostData),boot.initHost(e))},initHost:function(e){if(e){e.ingestServer="prod",iaw.cepUtil.usingStageAuthentication()?(iaw.cepUtil.setEnvironment("stage"),e.ingestServer="stage",iaw.log.console("Authentication environment to stage")):iaw.log.console("Authentication environment to production"),iaw.perf.set(iaw.perf.timers.InitHost),e.filters=iaw.fnft.generateFilters(e.hostID),iaw.localstorage.userID=e.adobeGUID,e.displayCount=parseInt(iaw.localstorage.getUserItem("fnft.displayCount")||0)+1,iaw.localstorage.setUserItem("fnft.displayCount",e.displayCount),iaw.store.set("host",e),window.__adobe_cep__&&iaw.log.logJSON("host.data: ",e);var t=e.language;if(iaw.i18n.addFromLocalLocaleFile(t,function(e){riotctrl.trigger("update-i18n-retro")}),riotctrl.trigger("update-host-retro"),iaw.motor.start(),iaw.startup.run(iaw.startup.PHASES.Doc),iaw.startup.run(iaw.startup.PHASES.Host),iaw.perf.measure(iaw.perf.timers.InitHost),iaw.perf.set(iaw.perf.timers.StockData),"mac"===e.platform){var a=!1,i=!1;document.addEventListener("keydown",function(e){91===e.which&&(a=!0),190===e.which&&(i=!0),a&&i&&window.__adobe_cep__.closeExtension()},!1),document.addEventListener("keyup",function(e){91===e.which&&(a=!1),190===e.which&&(i=!1)},!1)}if(window.__adobe_cep__){iaw.cepUtil.csInterface.addEventListener(iaw.cepUtil.events.HOSTCLOSEFNFT,function(){window.__adobe_cep__.closeExtension()}),iaw.log.console("CEP extension for "+e.hostID+" initializing - acquiring preset data..."),iaw.perf.set(iaw.perf.timers.HostPresetData);var r=e.hostID.toLowerCase();iaw.apps&&iaw.apps[r]?iaw.apps[r].initPresets(window.boot.initPresets,"fnft"):boot.initPresets(e.templates)}}},initPresets:function(e){for(var t={},a=iaw.store.get(["host","hostID"]),i=0;i<e.length;i++){var r=iaw.util.generateGUID();e[i].uuid=r,"ILST"===a&&e[i].lastUsedTime&&(e[i].lastUsedTime+=6e4*(new Date).getTimezoneOffset()),t[r]=i}iaw.store.set("presets",e),iaw.store.set("presetLUT",t),window.__adobe_cep__&&(iaw.log.logJSON("presets.data",e),iaw.log.logJSON("presets.lut",t)),riotctrl.trigger("update-host-retro"),iaw.perf.measure(iaw.perf.timers.HostPresetData),iaw.perf.measure(iaw.perf.timers.InteractiveTime,window.loadTime),window.__adobe_cep__&&setTimeout(boot.getTemplates,10)},getTemplates:function(){var e=iaw.store.get("host");iaw.fnft.getStockData(e,function(t){var a=t||iaw.fnft.generateDefaultStockData(e);iaw.log.logJSON("stock.data: ",a),iaw.perf.measure(iaw.perf.timers.StockData),iaw.perf.set(iaw.perf.timers.LicensedData),iaw.libraryManager.getLicensedTemplates(e.hostID).then(function(e){iaw.perf.measure(iaw.perf.timers.LicensedData),iaw.perf.measure(iaw.perf.timers.DataTime),boot.initTemplates(a,e)})["catch"](function(e){iaw.log.logJSON("get licensed templates error: ",e),boot.initTemplates(a,[])})})},initTemplates:function(e,t){iaw.perf.set(iaw.perf.timers.TemplateFixup);var a={},i=t.length,r=0,o=iaw.store.clone(["host","templates"])||[];for(t=t||[],r;r<i;++r)a[t[r].id]=r;window.__adobe_cep__&&iaw.log.logJSON("licensed.data: ",t);var n=iaw.store.get("presets");if(n&&n.forEach(function(e){if(e&&!e.isPreset){var t=iaw.libraryManager.getIdByElementRef(e.elementRef);iaw.localstorage.setUserItem("templateLUT_"+t,e.lastUsedTime)}}),e&&e.templates)for(i=e.templates.length,r=0;r<i;++r){var s=e.templates[r],l=a[s.id];if(void 0!==l){var w=t[l];s.url=w.url,s.elementRef=w.elementRef,s.lastUsedTime=iaw.localstorage.getUserItem("templateLUT_"+s.id)||w.modified,s.licensedTime=w.modified,s.thumbnail_url=w.thumbnail_url,s.template_category.push("recent"),s.template_category.push("saved")}void 0===s.lastUsedTime&&(s.lastUsedTime=0),void 0===s.licensedTime&&(s.licensedTime=0),o.push(s)}var p={};o=o.concat(t),o=o.filter(function(e,t){return!p[e.id]&&(p[e.id]=!0,!0)});var c={};for(i=o.length,r=0;r<i;++r){var f=iaw.util.generateGUID();o[r].uuid=f,c[f]=r}iaw.store.set("templates",o),iaw.store.set("templateLUT",c),iaw.startup.run(iaw.startup.PHASES.Done);var d=document.querySelector(".preset-grid-item--active");d||(d=document.querySelector(".template-grid-item--active")),d&&d.focus(),window.__adobe_cep__&&(iaw.log.logJSON("templates.data",o),iaw.log.logJSON("templates.lut",c)),iaw.perf.measure(iaw.perf.timers.TemplateFixup),iaw.perf.set(iaw.perf.timers.JSLibLateLoad),iaw.util.loadExternalScript("js/marked.min.js").then(function(e){riotctrl.trigger("markdown-ready-retro")}),iaw.util.loadExternalScript("js/fnft-lib.js").then(function(e){if("undefined"!=typeof Ingest){var t=iaw.store.get("host");iaw.perf.measure(iaw.perf.timers.JSLibLateLoad),iaw.analytics.config("CCXInAppWelcome",t,null,t.ingestServer)}}),iaw.perf.measure(iaw.perf.timers.LoadTime,window.loadTime),iaw.cepUtil.sendEvent(iaw.cepUtil.events.INTERACTIVEREADY,null)}},window.addEventListener("dragover",function(e){e=e||event,e.preventDefault()},!1),window.addEventListener("drop",function(e){e=e||event,e.preventDefault()},!1),window.addEventListener("dragstart",function(e){e=e||event,e.preventDefault()},!0),window.addEventListener("hashchange",function(e){e=e||event,e.preventDefault();var t=iaw.util.parseQueryString(location.hash);riotctrl.trigger("hashchange",t)},!1);
window.riotctrl={events:{},burnt:{},RETROACTIVE:"-retro",on:function(t,n,e){return(this.events[t]||(this.events[t]=[])).push({fn:n,ctx:e}),this.burnt[t]&&t.indexOf(this.RETROACTIVE)!==-1&&n.apply(e,this.burnt[t]),this},once:function(t,n,e){var i=this,s=function(){i.off(t,s),n.apply(e,arguments)};return this.on(t,s,e)},trigger:function(t){var n=[].slice.call(arguments,1),e=(this.events[t]||[]).slice(),i=0,s=null;for(i;s=e[i];i++)s.fn.apply(s.ctx,n);return t.indexOf(this.RETROACTIVE)!==-1&&(this.burnt[t]=n),this},off:function(t,n){var e=this.events[t],i=[];if(e&&n)for(var s=0,r=e.length;s<r;s++)e[s].fn!==n&&i.push(e[s]);return i.length?this.events[t]=i:delete this.events[t],this}};
//# sourceMappingURL=fnft-boot.js.map
